| VTチュートリアル ロボット接続編(FANUC) | Revision      | 第2版 |
| -------------------------------------- | ------------- | ----- |
| 作成者                                 | 株式会社YOODS |       |
| 作成日                                 | 2023年5月25日 |       |
| 最終更新日                             | 2024年2月29日 |       |

# 7.プログラムのロード ( FANUC )

| No   | 手順                                                                                                                                                                                    | 補足                                                                                                                                                                                                                                                           |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A140 | PCデスクトップ「VTマニュアル」のリンクを選択して<br />ダブルクリックしてください。 <br />  使用するロボットメーカーのフォルダを開き <br />「Robot_program」のフォルダを開いてください。 | ロボットへ必要なプログラムファイルを移行します。<br /> TPプログラム ●vt_main.tp ●vt.move.tp ●r_calib.tp ●b_server.tp <br />PCプログラム ●rovi_capture.pc ●rovi_detect.pc ●rovi_recipe.pc ●rovi_reset.pc ●rovi_solve.pc ●rovi_serever3.pc             |
| A141 | PCへUSBメモリを挿してください。<br />  選択したフォルダ内のファイルを 全てUSBへ<br />コピーしてください。 <br />  コピー完了後、USBを抜いてください。                                   | USBメモリフォルダは自動で出てきますが 出ない場合、ファイルマネージャーを開いて デバイス内のUSBフォルダを開いてください。<br />   USBを抜く際は、ファイルマネージャー左側メニュー                      デバイス内にあるUSBの マークを押してから抜いてください。 |
| A142 | TPへUSBメモリを挿して USB内のファイルを全てTPへ<br />ロードしてください。<br /> 完了後、USBメモリを抜いてください。                                               | TPのUSB差し込み口は ロボットメーカー取扱い説明書を参照してください。                                                                                                                                                                                           |

# 8.TPでの通信設定 ( FANUC )

| No   | 手順                                                                                                                                                                                                                                      | 補足                                                                                                                                                                                                          |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A150 | PCと通信するために ロボットIPアドレス等を設定していきます。                                                                                                                                                                               | バージョンによって操作方法が違うので、<br />ロボット取扱い説明書を参照してください。                                                                                                                          |
| A151 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「ホスト通信」 を 選んでください。                                                                                                                                  | aaa                                                                                                                                                                                                           |
| A152 | 「表示」 を選択して 「プロトコル」 を選んでください。                                                                                                                                                                                     |                                                                                                                                                                                                               |
| A153 | プロトコル設定の 「TCP/IP詳細設定」 を 選んで<br />ロボットIPアドレス、サブネットマスクを 入力してください。<br />  ロボットIPアドレスを設定<br /> 例) 192.168.221.10 サブネットマスクを設定 255.255.255.0                                |                                                                                                                                                                                                               |
| A154 | 「前戻」 ボタンで前画面に戻り 「表示」 を選択して<br />「クライアント」 を選んでください。 <br />  ﾀｸﾞ1 C1:を選択して右記設定を 入力してください。<br />入力後、 「操作」 ボタンを押して 「定義する」 を選択、<br />実行してください。 | ![1723083647649](image/VTlesson2/1723083647649.png)<br />ｺﾒﾝﾄ  : YOODS_VT <br />ﾌﾟﾛﾄｺﾙ  : SM <br />ｽﾀｰﾄｱｯﾌﾟ時の操作 :定義する <br />IP/ﾎｽﾄ名 : 192.168.221.2 <br />ﾘﾓｰﾄﾎﾟｰﾄ : 3000 |
| A155 | 「前戻」 ボタンで前画面に戻り 「表示」 を選択して<br />「サーバ」 を選んでください。<br />   ﾀｸﾞ5 S5:を選択して右記設定を 入力してください。                                                                                           | ｺﾒﾝﾄ  : YOODS_VT<br />ﾌﾟﾛﾄｺﾙ  : SM <br />ｽﾀｰﾄｱｯﾌﾟ時の操作 :スタートする <br />応答時間切れ : 1 min                                                                                          |
| A156 | 入力後、「操作」 ボタンを押して 「定義する」 →<br />「スタートする」の順で 選択、実行してください。                                                                                                                                      | 9.システム変数設定 ( FANUC )                                                                                                                                                                                  |

| No   | 手順                                                                                                                                                                                                                                                         | 補足                                              |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------- |
| A160 | TPの 「画面選択」 ボタンを押してください。<br />「システム」 メニューから 「システム変数」 を <br />選んでください。                                                                                                                                         |                                                   |
| A161 | 「$HOST**C** _CFG」 を選び A154で選択したタグ番号を<br />開いてください。 <br />（ デフォルト：1 [1]）                                                                                                                                                 | ![1723083573329](image/VTlesson2/1723083573329.png) |
| A162 | A154で入力した内容が反映されているか 確認してください。<br />$COMMENT : YOODS_VT $<br />PROTOCOL  : SM <br />$OPER : 2 (定義する) $<br />STATE : 2 (定義済) <br />$REMOTE : 192.168.221.2 $<br />STRT_REMOTE : 192.168.221.2 <br />$SERVER_PORT : 3000 | ![1723083524646](image/VTlesson2/1723083524646.png) |
| A163 | 「$KAREL_ENB」　を選び 「1」を 入力してください。                                                                                                                                                                                                            | ![1723083502148](image/VTlesson2/1723083502148.png) |

# 10.通信の実行と確認 ( FANUC )

| No   | 手順                                                                                                                       | 補足                                              |
| ---- | -------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| A170 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「バックグランド演算」 を <br />選んでください。     |                                                   |
| A171 | 空いている番号にカーソルを合わせて<br />「選択」 ボタンを押してください。                                                  | ![1723083466600](image/VTlesson2/1723083466600.png) |
| A172 | 「プログラム」 の中から ロードしたプログラム<br />「B_SERVER」 を 選択してください。                                       |                                                   |
| A173 | 設定ができたら 「実行」 を押した後、 電源再投入してください。<br />電源再投入後、プログラムが実行されているか 確認します。 | VTが起動、接続されている状態で ご確認ください。   |
| A174 | プログラム 「一覧」 ボタンを押して<br />「タイプ」 から 「カレル」 を選択してください。                                    |                                                   |

| No   | 手順                                                                                                                                                                                                            | 補足                                                                                            |
| ---- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| A175 | ロードしたプログラム 「ROVI_SERVER3」 を 選択、<br />「データ」 ボタンを押し 「画面」 ボタンから <br />「カレル変数」 を 選択してください。                                              |                                                                                                 |
| A176 | CONNECTED_の欄が 「TRUE」 に なっていれば<br />通信ができている状態です。                                                                                                                                       | ![1723082323677](image/VTlesson2/1723082323677.png)<br />aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa |
| A177 | SJ1_～SJ6はロボット各軸の現在値です。<br /> ロボットを動かして数値が変化するか 確認してください。                                                                                                               | ![1723082258930](image/VTlesson2/1723082258930.png)                                               |

# 11.不具合時の復旧 ( FANUC )

| No   | 手順                                                                                                                                                                                                                                                            | 補足                                              |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| A180 | VTとの通信プログラム 「B_SERVER」では<br />「フラグ」 を使用しています。<br />  VTとの通信を行うためには 「B_SERVER」 実行中に <br />「フラグ１」 をONする必要があります。<br />電源投入時は自動的に 「B_SERVER」が実行され、<br />「フラグ１」 が ONされます。 |                                                   |
| A181 | 運転中、ロボットプログラムが停止した場合は<br />以降の手順で復旧してください。                                                                                                                                                                                  |                                                   |
| A182 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「バックグランド演算」 を <br />選んでください。                                                                                                                                          |                                                   |
| A183 | 設定してある 「B_SERVER」 に カーソルを合わせ<br />「実行」 ボタンを押してください。<br />   エラーが出ている場合は、一度 「停止」 を 押した後、<br />「実行」 を押してください。                                                                               | ![1723082183263](image/VTlesson2/1723082183263.png) |
| A184 | TPの 「画面選択」 ボタンを押してください。<br /> 「I/O」 メニューから 「フラグ」 を 選んでください。                                                                                                                                                            |                                                   |
| A185 | 「#1」 にカーソルを合わせて 「オン」を 押してください。<br />   「オン」 を押した後、すぐ自動的に 「オフ」 に切り替わります。                                                                                                                                   | ![1723082142071](image/VTlesson2/1723082142071.png) |
| A186 | A174～A177の項目を確認して通信状態を 確認してください。                                                                                                                                                                                                         |                                                   |
